<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify Click Fix</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Verify Property Click Fix</h1>
        
        <div id="status"></div>
        
        <button onclick="testFix()">Test Click Handler Fix</button>
        <button onclick="window.location.href='/'">Back to Main App</button>
        
        <div id="testResult"></div>
    </div>
    
    <script>
        async function testFix() {
            const status = document.getElementById('status');
            const result = document.getElementById('testResult');
            
            status.innerHTML = '<div class="success">Testing click handler fix...</div>';
            
            // Test the fix approach
            const testHTML = `
                <h2>Test Table</h2>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border: 1px solid #ddd; padding: 8px;">Approach</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Test</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Result</th>
                        </tr>
                    </thead>
                    <tbody id="testTableBody"></tbody>
                </table>
                <div id="clickOutput" style="margin-top: 20px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px;">
                    <strong>Click Output:</strong> <span id="clickResult">Nothing clicked yet</span>
                </div>
            `;
            
            result.innerHTML = testHTML;
            
            const tbody = document.getElementById('testTableBody');
            const properties = [
                { address: '123 Test St', city: 'Las Vegas', state: 'NV' },
                { address: '456 Demo Ave', city: 'Henderson', state: 'NV' },
                { address: '789 Example Rd', city: 'Reno', state: 'NV' }
            ];
            
            // Test function for clicks
            window.testShowPropertyDetail = function(index) {
                document.getElementById('clickResult').textContent = `Property ${index} clicked: ${properties[index].address}`;
                console.log('testShowPropertyDetail called with index:', index);
            };
            
            properties.forEach((prop, index) => {
                const row = document.createElement('tr');
                
                // Old approach (inline onclick)
                const oldHTML = `
                    <td style="border: 1px solid #ddd; padding: 8px;">Inline onclick (old)</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">
                        <span onclick="testShowPropertyDetail(${index})" 
                              style="color: #667eea; cursor: pointer; text-decoration: underline;">
                            ${prop.address} (Old)
                        </span>
                    </td>
                    <td style="border: 1px solid #ddd; padding: 8px;" id="oldResult${index}">Click to test</td>
                `;
                
                row.innerHTML = oldHTML;
                tbody.appendChild(row);
                
                // New approach (programmatic event listener)
                const newRow = document.createElement('tr');
                const newHTML = `
                    <td style="border: 1px solid #ddd; padding: 8px;">Event listener (new)</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">
                        <span class="clickable-address" data-index="${index}"
                              style="color: #667eea; cursor: pointer; text-decoration: underline;">
                            ${prop.address} (New)
                        </span>
                    </td>
                    <td style="border: 1px solid #ddd; padding: 8px;" id="newResult${index}">Click to test</td>
                `;
                
                newRow.innerHTML = newHTML;
                tbody.appendChild(newRow);
                
                // Attach event listener (the fix approach)
                const addressSpan = newRow.querySelector('.clickable-address');
                if (addressSpan) {
                    addressSpan.addEventListener('click', function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        testShowPropertyDetail(idx);
                        document.getElementById(`newResult${idx}`).innerHTML = '<span style="color: green;">✓ Clicked!</span>';
                    });
                }
            });
            
            // Also update old results when clicked
            tbody.querySelectorAll('span[onclick*="testShowPropertyDetail"]').forEach((span, i) => {
                const originalOnclick = span.onclick;
                span.onclick = function() {
                    if (originalOnclick) originalOnclick.call(this);
                    document.getElementById(`oldResult${i}`).innerHTML = '<span style="color: green;">✓ Clicked!</span>';
                };
            });
            
            status.innerHTML += '<div class="success">✓ Test setup complete. Try clicking the addresses above.</div>';
        }
        
        // Auto-run test on load
        window.onload = testFix;
    </script>
</body>
</html>