<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Modal Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Modal Function Test</h1>
    
    <iframe src="index.html" style="display:none" id="testFrame"></iframe>
    
    <button onclick="testModalFunctions()">Test All Modal Functions</button>
    
    <div id="results"></div>
    
    <script>
        function testModalFunctions() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Test Results:</h2>';
            
            const iframe = document.getElementById('testFrame');
            const iframeWindow = iframe.contentWindow;
            
            // Test 1: Check if functions exist
            const functions = ['openAddPropertyModal', 'openAnalyzeModal', 'generateMarketInsights'];
            
            functions.forEach(funcName => {
                const exists = typeof iframeWindow[funcName] === 'function';
                const result = document.createElement('div');
                result.className = exists ? 'test-result success' : 'test-result error';
                result.innerHTML = `<strong>${funcName}:</strong> ${exists ? 'âœ“ Function exists' : 'âœ— Function not found'}`;
                resultsDiv.appendChild(result);
                
                if (exists) {
                    // Test if function can be called without errors
                    try {
                        // Capture console output
                        const originalLog = console.log;
                        const originalError = console.error;
                        let logs = [];
                        let errors = [];
                        
                        console.log = function(...args) {
                            logs.push(args.join(' '));
                            originalLog.apply(console, args);
                        };
                        console.error = function(...args) {
                            errors.push(args.join(' '));
                            originalError.apply(console, args);
                        };
                        
                        // Call the function
                        iframeWindow[funcName]();
                        
                        // Restore console
                        console.log = originalLog;
                        console.error = originalError;
                        
                        const callResult = document.createElement('div');
                        callResult.className = errors.length === 0 ? 'test-result success' : 'test-result error';
                        callResult.innerHTML = `<strong>${funcName} call:</strong> ${
                            errors.length === 0 
                                ? 'âœ“ Function called successfully' 
                                : 'âœ— Function threw errors: ' + errors.join(', ')
                        }`;
                        if (logs.length > 0) {
                            callResult.innerHTML += '<br><small>Logs: ' + logs.join(', ') + '</small>';
                        }
                        resultsDiv.appendChild(callResult);
                        
                    } catch (e) {
                        const errorResult = document.createElement('div');
                        errorResult.className = 'test-result error';
                        errorResult.innerHTML = `<strong>${funcName} call:</strong> âœ— Exception: ${e.message}`;
                        resultsDiv.appendChild(errorResult);
                    }
                }
            });
            
            // Check for emergency script
            const emergencyScriptActive = iframe.contentDocument.documentElement.innerHTML.includes('ðŸš¨ EMERGENCY FIX: Redefining modal functions');
            const emergencyResult = document.createElement('div');
            emergencyResult.className = emergencyScriptActive ? 'test-result error' : 'test-result success';
            emergencyResult.innerHTML = `<strong>Emergency Script:</strong> ${emergencyScriptActive ? 'âœ— Still active (should be commented out)' : 'âœ“ Properly commented out'}`;
            resultsDiv.appendChild(emergencyResult);
        }
        
        // Wait for iframe to load
        window.onload = function() {
            setTimeout(testModalFunctions, 2000);
        };
    </script>
</body>
</html>